# Экосистема разработки

## Понятие уровней репозиториев кода:

В процессе разработки, в связи с увеличением объема исходного кода и различных ресурсов, возникает необходимость его логического упорядочивания.

Стремление повторного использования кода и его разноуровненость позволяет разделить код на группы.

Таким образом, в компании предусмотрено следующая логическая градация исходного кода и ресурсов:

- [base](#) (в основном это стороние библиотеки, фреймворки или интсрументы, которые используются в процессе разработки "как есть")
- [devkit](#) (атомарные компоненты, обертки сторонних js библиотек, утилиты, в целом достаточно универсальные для повторного использования в разных проектах)
- [prefab](#) (болие крупные, специфичные для решения определенной задачи компоненты, но всеже позволяющие повторное использование в разных проектах)
- [proline](#) (крупные блоки, реализуемые под определенный спектр задач, как составные части конкрыетных проектов или приложений, узкоспециализированные и часто не позволяющие повторного использования)
- [projects](#) (логически законченные, самостоятельные программные единицы, могут быть использованы как отдельные приложения или в качестве функциональных единиц в составе болие крупных приложений)
- [app](#) (конечные приложения, строящиеся из блоков и компонентов различной градации, могут являтся композицией из других, объединенных близким кругом задач, приложений)
- [tools](#) (инструменты поддержки "dev time")

Каждая группа представляет собой совокупность репозиториев и предоставляет гибкое управления доступом.

Таким образом, разработчик может иметь доступ только к проектам (или их частям) над которым он работает.





## Структура исходников типового проекта (typescript)

Исходный код типового проекта должен быть написан на языке typescript.


### Стремление к компонентно-ориентированной архитектуре

Компоненты являются основным средством расширения функциональных возможностей приложения.

Они предназначены для многократного использования, имеют определённый интерфейс и взаимодействуют с программной средой посредством событий.

Компонент может иметь зависимости на другие компоненты, таким образом он должен быть изначально спроектирован для повторного использования.

Компоненты должны быть спроектированы в соответствии с принципом слабого связывания.

Для этого реализуется событийная модель на основе шаблона Обозреватель (Observer), что позволяет подписываться нескольким получателям на одно и то же событие.

Комонент является черным ящиком и внешний мир общается с ним по средством тонкого публичного интерфейса.

В свою очередь, вся сложность реализации компонента может быть упорядочена внутри комонента в виде взаимодействующих подсистем разных уровней абстракции.

Таким образом, разбиения функционала на компоненты с тонкими интерфейсами, является критической важностью для контроля сложности.


#### Пример организации исходников компонента:

* [network](#) (основной компонент)
    * [api](#) (публичный интерфейс основного компонента)
        * [Network.ts](#)
    * [impl](#) (внутренняя реализация основного компонента, может быть разбита на подсистемы)
        * [channel](#) (подсистема)
            * [api](#) (публичный интерфейс подсистемы)
                * [Channel.ts](#)
            * [impl](#) (реализация подсистемы, может быть разбита на подсистемы)
                * [receiver](#) (подсистема)
                    * [api](#) (публичный интерфейс подсистемы)
                        * [Receiver.ts
                    * [impl](#) (реализация подсистемы)
                        * [ReceiverImpl.ts](#)
                    * [test](#) (юнит-тесты реализациии подсистемы на данном уровне абстракци)
                        * [receiverSpec.ts](#)
                * [ChannelImpl.ts](#)
            * [test](#) (юнит-тесты реализациии подсистемы на данном уровне абстракци)
                * [channelSpec.ts](#)
        * [dispatcher](#) (подсистема)
            * [api](#) (публичный интерфейс подсистемы)
                * [Dispatcher.ts](#)
            * [impl](#) (реализация подсистемы)
                * [DispatcherImpl.ts](#)
            * [test](#) (юнит-тесты реализациии подсистемы на данном уровне абстракци)
                * [dispatcherSpec.ts](#)
        * [NetworkImpl.ts](#)
    * [test](#) (юнит-тесты реализациии подсистемы на данном уровне абстракци)
        * [networkSpec.ts](#)
    * [test-app](#) (произвольное приложение для тестирование основного компонента через его публичный интерфейс)
        * [index.html](#)
    * [client-helper](#) (специфичный для данного основного компонента функционал его многократного использования)
        * [NetworkSingletonUtil.ts](#)
* [NetworkModule.ts](#) (фасад декларирующий комплексный публичный интерфейс для всего компонента)






## Процесс сборки типового проекта (кратко)

Процесс сборки типового проекта частично автоматизирован и позволяет значительно экономить время в процессе разработки, одновременно с этим, предоставляя гибкость в настройке.

Процесс сборки разных видов несколько отличается, однако позволяет выделить общие этапы:

### Процесс сборки приложения (основное или тестовое)

  - конфигурация проекта и настройка зависимостей на используемые модули
  - компиляция typescript в javascript
  - автоматическое постороение графа зависимостей в виде AMD модулей
  - конкатанация AMD модулей с внешними зависимостями в один итоговый файл (app.js)
  - инклуд AMD загрузчика в итоговый js файл
  - оптимизация и минификация итогового js файла
  - снабжение внещними ресурсами (css, html, картинки, шрифты)

Пример результата сборки тестового приложения для компонента network:
  - index.html
  - app.js


### Процесс сборки компонента (набор компонентов, сторонний компонент)

  - конфигурация проекта и настройка зависимостей на используемые модули
  - компиляция typescript в javascript
  - генерация или загрузка с внешнего ресурса TypeScript definition файлов (*.d.ts)
  - автоматическое постороение графа зависимостей в виде AMD модулей
  - конкатанация AMD модулей без внешних зависимостей в один итоговый файл (*.js)

Пример результата сборки компонента network:
- NetworkModule.js
- NetworkModule.d.ts


#### Быстрый старт

(здесь будет алгоритм действий для сборки demo приложения)



## Виды тестирования компонентов

Для гарантии работоспособности компонентов организованы следующие виды тестирования:



### Быстрые тесты внутри модуля

Удобны для тестирования отдельных подсистем компонента в процессе "dev time"

Организованы на популярном тест-фреймворке jasmine

Должны быть реализованы на языке typescript

Запускаются в среде karma, что позволяет запускать автаматическое тестирование на различных браузерах

Размещается в корне одной из подсистем компонента в директории test в файлах вида *Spec.ts

#### Быстрый старт

(здесь будет алгоритм действий для запуска тестов)



### Внешние тесты модулей через API модуля

Удобны для периодического тестирования компонента или подтверждения его актуального работоспособного состояния

Представляет из себя простое тестовое приложение, с линейным произвольным набором тестов с выводом в лог на страницу или консоль браузера

Должны быть реализованы на языке typescript

Размещается в корне проекта компонента в директории test

#### Быстрый старт

(здесь будет алгоритм действий для запуска тестов)



### Тестовые приложения

Удобны для детального тестирования возможностей компонента

Представляет из себя упращенное, но близкое к боевым, по набору задействонного функционала компонента, условиям, тестовое приложение

Должны быть реализованы на языке typescript

Размещается в корне проекта компонента в директории test-app

#### Быстрый старт

(здесь будет алгоритм действий для запуска тестов)







## Система быстрого создания типовых шаблонов и сборки проектов

Система предусматривает быстрое создание из консоли шаблоны четырех типов проектов:

* [Компонент](#)
* [Набор компонентов](#)
* [Сторонний компонент](#)
* [Приложение](#)

Также система предусматривает генерацию наборов скриптов для управления процессом сборки проекта в различных ОС (Windows, Linux)

#### Быстрый старт

* Ставим [Nodejs](https://nodejs.org/). В состав уже входит npm
* Обновляем npm до последней версии
````shell
npm update -g npm
````
* Ставим глобально bower
````
npm install -g bower
````
* Ставим глобально grunt cli
````
npm install -g grunt-cli
````
* Ставим глобально tsd
````
npm install -g tsd
````
* Ставим глобально yeoman
````
npm install -g yo
````
* Ставим наш yeoman генератор
````
npm install -g generator-boilerplate@git+ssh://git@git.providesupport.com:tools/js/yeoman-generator/generator-boilerplate/dist
````
* В консоли переходим в директорию где находяться ваши проекты 
````
cd путь/к/директории/с/проектами
````
* Запускаем наш генератор проектов
````
yo boilerplate
````
* Конфигурируем новый проект типа 'компонент' (project-per-module). Инсталируем все что предлагается в опроснике и генерим скрипты.
* Собираем модуль
````
dev/scripts/build.cmd
```` 
* Публикуем модуль
````
dev/scripts/publish.cmd
```` 
* Собираем и запускаем тест-модуль в режиме debug
````
test/scripts/build_and_run_integ_debug_test.cmd
```` 

### Структура проекта типа 'компонент' (project-per-module)

 [Компонент](#) - bower компонент состоящий из одного модуля. Модуль состоит из реализации на языке javascript и публичного API в формате описания типов на языке typescript, сгенеренных в просессе сборки

Структура проекта состоит из трех независимых git репозиториев:

* [dev](#dev) - репозиторий разработки typescript модуля
* [dist](#dist) - репозиторий публикации typescript модуля в продакшен для использования в качестве зависимости в других модулях
* [test](#test) - репозиторий тестирования typescript модуля

#### Структура  DEV репозитория

##### Основные ресурсы хранящиеся в репозитории

* [src](#) - директория с исходниками модуля на языке typescript
* src/[_all.ts](#) - файл с ссылками на другие typescript модули 
* src/[#####Module.ts](#) - главный фасадный файл typescript модуля 
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [tsconfig.json](#) - конфигурационный файл для компилятора typescript ( используется для настройки компиляции и управления повидением различных IDE )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория
* [karma.config.js](#) - конфигурационный файл для тест-раннера karma
* [test-main.js](#) - конфигурационный файл для поддержки запуска тестов в karma посредствам requirejs(AMD) загрузчика

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* [build](#) - директория для результатов компиляции typescript исходников
* [out](#) - директория для конечных результатов сборки модуля
* [.tscache](#) - директория с временными файлами typescript компилятора

#### Структура  DIST репозитория

##### Основные ресурсы хранящиеся в репозитории

* [bower.json](#) - конфигурационный файл для публикуемого bower компонента
* [#####Module js](#) - главный файл реализации модуля на языке javascript 
* [#####Module.d.ts](#) - главный файл публичного API модуля в формате описания типов на языке typescript

#### Структура TEST репозитория

##### Основные ресурсы хранящиеся в репозитории


* [integ](#) - директория с интеграционным тестом на языке typescript
* integ/[src](#) - директория с исходниками тест-модуля на языке typescript
* integ/src/[_all.ts](#) - файл с ссылкой на тестируемый typescript модуль
* integ/src/[#####ModuleTest.ts](#) - главный фасадный файл typescript тест-модуля 
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [tsconfig.json](#) - конфигурационный файл для компилятора typescript ( используется для настройки компиляции и управления повидением различных IDE )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория 

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке тест-модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* integ/[build](#) - директория для результатов компиляции typescript исходников интеграционного теста
* integ/[www](#) - директория для запуска интеграционного тест-модуля в веб-браузере
* [.tscache](#) - директория с временными файлами typescript компилятора

### Структура проекта типа 'набор компонентов' (project-per-modules)

[Набор компонентов](#) - bower компонент состоящий из нескольких модулей. Модуль состоит из реализации на языке javascript и публичного API в формате описания типов на языке typescript, сгенеренных в просессе сборки

Структура проекта состоит из трех независимых git репозиториев:

* [dev](#dev) - репозиторий разработки набора typescript модулей
* [dist](#dist) - репозиторий публикации typescript модуля в продакшен для использования в качестве зависимости в других модулях
* [test](#test) - репозиторий тестирования typescript модуля

#### Структура  DEV репозитория

##### Основные ресурсы хранящиеся в репозитории

* [src](#) - директория с исходниками набора модулей на языке typescript
* src/[модуль из набора](#) - директория с исходниками одного модуля из набора
* src/модуль из набора/[_all.ts](#) - файл с ссылками на другие typescript модули 
* src/модуль из набора/[#####Module.ts](#) - главный фасадный файл typescript модуля из набора 
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [tsconfig.json](#) - конфигурационный файл для компилятора typescript ( используется для настройки компиляции и управления повидением различных IDE )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория 

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* [build](#) - директория для результатов компиляции typescript исходников
* [out](#) - директория для конечных результатов сборки модуля
* [.tscache](#) - директория с временными файлами typescript компилятора

#### Структура  DIST репозитория

##### Основные ресурсы хранящиеся в репозитории

* [bower.json](#) - конфигурационный файл для публикуемого bower компонента
* [модуль из набора](#) - директория с одним модулем из набора
* модуль из набора/[#####Module js](#) - главный файл реализации модуля из набора на языке javascript 
* модуль из набора/[#####Module.d.ts](#) - главный файл публичного API модуля из набора в формате описания типов на языке typescript

#### Структура TEST репозитория

#### Основные ресурсы хранящиеся в репозитории


* [integ](#) - директория с интеграционными тестами на языке typescript
* integ/[src](#) - директория с исходниками набора тест-модулей на языке typescript
* integ/src/[модуль из набора](#) - директория с одним тест-модулем из набора
* integ/src/модуль из набора/[_all.ts](#) - файл с ссылкой на тестируемый typescript модуль из набора
* integ/src/модуль из набора/[#####ModuleTest.ts](#) - главный фасадный файл typescript тест-модуля из набора
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [tsconfig.json](#) - конфигурационный файл для компилятора typescript ( используется для настройки компиляции и управления повидением различных IDE )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория 

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке тест-модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* integ/[build](#) - директория для результатов компиляции typescript исходников интеграционных тестов из набора
* integ/[www](#) - директория для запуска интеграционных тест-модулей в веб-браузере
* [.tscache](#) - директория с временными файлами typescript компилятора

### Структура проекта типа 'сторонний компонент' (project-per-3plib)

[Сторонний компонент](#) - bower компонент состоящий из одного модуля. Модуль состоит из реализации на языке javascript, в основе которого лежит файл сторонней библиотеки, а также публичного API в формате описания типов на языке typescript, скачанного с [DefinitelyTyped](https://github.com/borisyankov/DefinitelyTyped)

Структура проекта состоит из трех независимых git репозиториев:

* [dev](#dev) - репозиторий разработки typescript модуля
* [dist](#dist) - репозиторий публикации typescript модуля в продакшен для использования в качестве зависимости в других модулях
* [test](#test) - репозиторий тестирования typescript модуля

#### Структура  DEV репозитория

##### Основные ресурсы хранящиеся в репозитории

* [tsd.json](#) - конфигурационный файл для скачивания публичного API в формате описания типов на языке typescript с [DefinitelyTyped](https://github.com/borisyankov/DefinitelyTyped)
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория 

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* [tsd](#) - директория для скачаного публичного API в формате описания типов на языке typescript
* [out](#) - директория для конечных результатов сборки модуля

#### Структура  DIST репозитория

##### Основные ресурсы хранящиеся в репозитории

* [bower.json](#) - конфигурационный файл для публикуемого bower компонента
* [#####Module js](#) - главный файл реализации модуля на языке javascript 
* [#####Module.d.ts](#) - главный файл публичного API модуля в формате описания типов на языке typescript
* [другие файлы и папки](#) - сопутствующие ресурсы сторонней библиотеки (иконки, картинки, шрифты, html-шаблоны, сss-стили)

#### Структура TEST репозитория

##### Основные ресурсы хранящиеся в репозитории


* [integ](#) - директория с интеграционным тестом на языке typescript
* integ/[src](#) - директория с исходниками тест-модуля на языке typescript
* integ/src/[_all.ts](#) - файл с ссылкой на тестируемый typescript модуль
* integ/src/[#####Test.ts](#) - главный фасадный файл typescript тест-модуля 
* [bower.json](#) - конфигурационный файл для bower компонентов ( используется для указания зависимостей на другие bower компоненты ) 
* [gruntfile.js](#) - конфигурационный файл для grunt плагина grunt-project-builder ( используется для сборки проекта )
* [tsconfig.json](#) - конфигурационный файл для компилятора typescript ( используется для настройки компиляции и управления повидением различных IDE )
* [gitignore](#) - файл для исключения побочных файлов сборки из git репозитория 

##### Побочные ресурсы не хранящиеся в репозитории

* [node_modules](#) - директория для установки npm компонентов ( используются как вспомогательные инструменты при сборке модуля )
* [bower_components](#) - директория для установки bower компонентов ( используются в качестве зависимостей при сборке тест-модуля )
* [scripts](#) - директория для генерации скриптов для управления процессом сборки
* integ/[build](#) - директория для результатов компиляции typescript исходников интеграционного теста
* integ/[www](#) - директория для запуска интеграционного тест-модуля в веб-браузере
* [.tscache](#) - директория с временными файлами typescript компилятора







